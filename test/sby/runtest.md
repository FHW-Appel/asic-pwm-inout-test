# Formal Verification Test Instructions

This document provides instructions for running formal verification tests using SymbiYosys (sby).

## Prerequisites

- Docker must be installed on your system
- IIC-OSIC-TOOLS Docker container must be available

## Setup Instructions

### 1. Start Docker Service

First, ensure the Docker service is running on your system:

```bash
systemctl start docker
```

### 2. Verify Docker Status

Check that Docker is running properly:

```bash
systemctl status docker
```

You should see an active (running) status.

### 3. Launch the OSIC Tools Container

Start the Docker container with the verification tools:

```bash
./IIC-OSIC-TOOLS/start_x.sh
```

A new terminal window will appear with the container environment ready. Continue inside the new terminal.

## Running Tests

Navigate to the test directory:
   ```bash
   cd test/sby/
   ```

### Testing out_stage Module

To perform formal verification on the `out_stage.v` module:

Run the formal verification:
   ```bash
   sby -f out_stage.sby
   ```

The `-f` flag forces a fresh run, removing any previous verification results.

Results will be saved in the `out_stage_<taskname>/` sub directory.

### Testing in_stage Module

To perform formal verification on the `in_stage.v` module:

Run the formal verification:
   ```bash
   sby -f in_stage.sby
   ```

Results will be saved in the `in_stage_<taskname>/` sub directory.

## View the test results

### Quick status check

After a run, each module has a result folder with a `status` file and a `logfile.txt` summary:

```bash
cat <modulename_taskname>/status
tail -n 50 <modulename_taskname>/logfile.txt
```

- `PASS` indicates all properties were proven.
- `FAIL` indicates a counterexample was found (see traces below).
- `UNKNOWN` can occur if engines timed out or were inconclusive.

### Detailed logs

The main `logfile.txt` in each result folder contains the full SymbiYosys run log. The per-engine logs (e.g., `engine_0/logfile.txt`) show solver details:

```bash
less <modulename_taskname>/logfile.txt           # run summary and status
less <modulename_taskname>/engine_0/logfile.txt  # engine-specific details
```

### Viewing waveforms (if a trace was produced)

When a cover is reached or an assertion fails, SymbiYosys generates a VCD trace that you can inspect in GTKWave.

```bash
gtkwave <modulename_taskname>/engine_x/tracex.vcd
```

For some modules, a `.gtkw` file is prepared. It defines a preselected set of signals and layout to speed up review. Use it by passing the file to GTKWave:

```bash
gtkwave <modulename_taskname>/engine_x/tracex.vcd <modulename>.gtkw
```

Tip: append `&` to run GTKWave in the background. This keeps the console free to re-run `sby` after quick fixes and you can reload the waveform via the menu `File -> Reload Waveform`.

You can also review the witness testbench generated by the engine:

```bash
sed -n '1,200p' <modulename_taskname>/engine_x/tracex_tb.v
```

Note: Some proofs may not produce VCD traces if all properties are proven without counterexamples or explicit covers.

### Common artifacts

- `status`: final run status (`PASS`, `FAIL`, `UNKNOWN`).
- `logfile.txt`: top-level run log and summary.
- `engine_x/tracex.vcd`: waveform of the counterexample or cover (if generated).
- `engine_x/tracex_tb.v`: Verilog witness testbench describing the trace.
- `model/design_smt2.smt2`: solver model used for the run (advanced).
